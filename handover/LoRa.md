# Loraについて
文責：野村  
QueenBeeでは、機体と地上の通信にLoRaを用いていました。製品名はES920LRです。基本的な使い方はデータシート等を見ればわかると思うので、
ここでは注意点のみを書いておきます。    
## 本体の取り扱い
何よりもまず、機器を丁寧に扱うことが大事です。実物を見ればわかるように、ピンが多くあって接続不良を起こしやすいです。加えて、
外付けアンテナも外れやすく、外れた場合、はんだで繋ぎなおしても通信を送ることができない可能性が高いです。
(QueenBeeの場合はアメリカでアンテナが外れてしまい、本番はアンテナなしで挑むことになりました。)  
また、LoRaの実験の際は評価基板やプリント基板に取り付けたピンソケットにLoRa本体を差すことになりますが、おそらく**抜き差しの回数はなるべく減らした方がいい**
です。抜き差しするたびにピンが外側に広がってしまい、接触不良を起こすようになってしまいます。  
QueenBeeの場合はピンソケットを使わずに、基板とLoRaを直付けする工事をアメリカで行いました。これが接触不良を起こさない確実な方法な気がします。
## コードの説明
QueenBeeでは、lora_queenbee.pyというファイルでLoraというクラスを定義しています。クラス内では機体から数秒おきにメッセージを発する関数
（cycle_send）などが定義されています。  
基本的にはこの関数を用いていて、各シーケンス（収納、放出、着地、飛行）に応じてメッセージの内容を変えています。
具体的に、例えばcycle_send_progress2という関数なら、収納、放出、着地のどの状態であるか、その状態に遷移して
どれほど時間が経過しているかをcase_.messageというCaseクラスで定義された変数から持ってきて、それを5秒おきに送信しています。  
どのようなメッセージを送るかはミッションに応じて考えるといいと思います。ただ、アメリカでは機体のロストを避けるために座標の送信はした方がいい気がします。
## 通信要らなくね問題
ここまで書きましたが、地上と機体の通信が無くても、機体がゴールに着いてさえしまえばいいのでLoRaは適当でもいい説があります。
ただ、LoRaがないと機体がどうなっているか全くわからないので、ミッションが始まった後かなり不安になります。
QueenBeeではそれを避けるために座標以外にも複数種類のメッセージを送るようにしています（開発中にほかにすることがない暇な時期があったからでもあります）。  
追加で、アメリカでARLISS本番の時、いざ機体をロケットに詰めた後、メッセージがおかしかったことから不具合に気付き、
発射前に解決できたことがありました。そのため、LoRa通信を確実なものにしておくことにも意味があると思います（たぶん）。
# 最後に
Cansatは機体が組みあがらないことには実験できないため、制御系が自分たちの実験を満足にできるのはかなり後になってしまいます。
加えて、能代やARLISSの環境は想定していたものと違ったりするので、大会期間中に忙しくなることもあると思います。
そのため、特に開発序盤は一人ひとりが専門化しすぎることなく、連携を取り合って開発を進めることが大事だと思います。  
なるべく大学や松戸の実験に行く、みんなで話し合う、一緒にご飯を食べる（意外と大事だと個人的には思っています）、このあたりを一番大事にして頑張ってください！
